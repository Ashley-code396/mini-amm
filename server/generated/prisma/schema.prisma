generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// Tracks Sui events emitted by mini_amm modules
model poolEvent {
  id        Int      @id @default(autoincrement())
  digest    String   @unique
  type      String
  sender    String?
  payload   Json
  timestamp BigInt
  processed Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/// Stores pool state derived from events
model pool {
  id        Int      @id @default(autoincrement())
  poolId    String   @unique
  token1    String?
  token2    String?
  reserveA  BigInt
  reserveB  BigInt
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/// Stores last processed cursor for each event type
model eventCursor {
  id        String   @id
  txDigest  String?
  eventSeq  Int?
  updatedAt DateTime @updatedAt
}

/// Unified transaction tracking for all user activities
model userTransaction {
  id          Int      @id @default(autoincrement())
  userAddress String
  poolId      String?
  type        String // "LiquidityAdded", "LiquidityRemoved", "SwapExecuted"
  token1      String?
  token2      String?
  amount1     String? // Changed to String to handle BigInt
  amount2     String? // Changed to String to handle BigInt
  lpAmount    String? // LP tokens minted/burned
  txDigest    String   @unique
  timestamp   BigInt
  createdAt   DateTime @default(now())

  @@index([userAddress])
  @@index([poolId])
  @@index([timestamp])
}
